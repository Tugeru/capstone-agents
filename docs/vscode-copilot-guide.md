# VS Code Copilot Guide

This guide explains how to use Capstone Agents with VS Code Copilot (Chat & Extension).

## Prerequisites

- VS Code installed
- GitHub Copilot extension installed and activated
- GitHub account with Copilot access

## Setup

### 1. Run the Setup Script

```bash
python scripts/setup_vscode_copilot.py
```

This creates:
- `.vscode/tasks.json` — Pre-configured tasks for running agents
- `capstone-agents.code-workspace` — Workspace file with Copilot settings

### 2. Open the Workspace

```bash
code capstone-agents.code-workspace
```

Or in VS Code: **File → Open Workspace from File → Select `capstone-agents.code-workspace`**

---

## Using Agents in Copilot Chat

### Method 1: System Prompt Injection (Recommended)

1. Open the agent's Markdown file (e.g., `agents/backend/backend-planning.md`).
2. Select all text (`Ctrl+A`) and copy (`Ctrl+C`).
3. Open Copilot Chat:
   - **Inline**: `Ctrl+I` (Windows/Linux) or `Cmd+I` (macOS)
   - **Sidebar**: Click the Copilot icon in the sidebar
4. Paste the content into the chat input.
5. Append your request:
   ```
   You are now this agent. Analyze the current project structure and propose a backend architecture.
   ```

### Method 2: Workspace Context (@workspace)

1. Ensure the agent file is open in the editor.
2. Open Copilot Chat.
3. Type `@workspace` to include workspace context.
4. Ask:
   ```
   @workspace Using the agent definition in the open file, generate a plan for the database schema.
   ```

### Method 3: File Reference (#file)

1. Open Copilot Chat.
2. Reference the agent file directly:
   ```
   #file:agents/frontend/frontend-planning.md
   
   Act as this agent and create a component hierarchy for a dashboard.
   ```

---

## Running Tasks

VS Code Tasks provide a convenient way to run agent scripts.

### Available Tasks

| Task | Description |
|------|-------------|
| Run Coordinator Agent | Start the Coordinator for project planning |
| Run Frontend Agent | Run the Frontend planning agent |
| Run Backend Agent | Run the Backend planning agent |
| Run All Planning Agents | Run all planning agents in parallel |
| Validate All Agents | Validate all agent file structures |
| Generate New Agent | Scaffold a new agent from template |
| Setup VS Code Copilot | Regenerate Copilot configuration |

### Running a Task

1. Press `Ctrl+Shift+P` (or `Cmd+Shift+P` on macOS).
2. Type `Tasks: Run Task`.
3. Select the desired task (e.g., `Run Coordinator Agent`).
4. View output in the integrated terminal.

### Keyboard Shortcut

Set up a keyboard shortcut for quick access:

1. **File → Preferences → Keyboard Shortcuts**
2. Search for `Tasks: Run Task`
3. Assign a shortcut (e.g., `Ctrl+Shift+T`)

---

## Copilot Chat Participants

VS Code Copilot provides special participants for enhanced context:

### @workspace
Include the entire workspace context.
```
@workspace What is the project structure and how should I organize the frontend?
```

### @terminal
Reference terminal output.
```
@terminal The last command failed. What went wrong?
```

### @vscode
Ask about VS Code features.
```
@vscode How do I configure tasks.json for this project?
```

---

## Effective Prompting with Agents

### Pattern 1: Role Activation

```
I'm pasting an agent definition below. Please adopt this role and help me with my project.

[Paste agent .md content here]

Now, as this agent, please analyze the project requirements in docs/requirements.md and create a detailed plan.
```

### Pattern 2: Multi-Agent Simulation

```
I have two agents: a Frontend Planning Agent and a Backend Planning Agent. 
I'll paste their definitions, and I need you to simulate a conversation between them 
to design a cohesive API contract.

Frontend Agent:
[Paste frontend-planning.md]

Backend Agent:
[Paste backend-planning.md]

Now simulate their discussion about the user authentication API.
```

### Pattern 3: Plan Review

```
Here is a plan generated by the Database Engineer agent:
[Paste database-engineer-plan.json]

As the Software Architect agent (whose definition is in #file:agents/software-architect/software-architect-planning.md), 
review this plan for potential issues and improvements.
```

---

## Integration with Tasks.json

The `.vscode/tasks.json` file contains pre-configured tasks:

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Run Coordinator Agent",
      "type": "shell",
      "command": "python",
      "args": ["scripts/run_agents.py", "--agents", "coordinator", "--cli", "vscode"],
      "group": "build"
    },
    {
      "label": "Validate All Agents",
      "type": "shell",
      "command": "python",
      "args": ["scripts/validate-agent.py", "."],
      "group": "test"
    }
  ]
}
```

### Adding Custom Tasks

Add new tasks for specific workflows:

```json
{
  "label": "Full Stack Planning",
  "type": "shell",
  "command": "python",
  "args": [
    "scripts/run_agents.py",
    "--agents", "coordinator", "software-architect", "frontend", "backend",
    "--cli", "vscode"
  ],
  "group": "build"
}
```

---

## Tips and Best Practices

### 1. Keep Agent Context in View
When using Method 1, keep the agent file open in a split view so you can reference it.

### 2. Use Copilot Inline for Implementation
After planning with Copilot Chat, use inline Copilot (`Ctrl+I` in editor) to implement the plan.

### 3. Save Chat History
Export important Copilot Chat conversations for documentation.

### 4. Combine with MCP Tools
For agents requiring MCP tools, start the MCP servers before using Copilot:
```bash
npx -y @modelcontextprotocol/server-filesystem .
```

### 5. Use Snippets for Frequent Prompts
Create VS Code snippets for common agent prompts:

**File → Preferences → Configure User Snippets → New Global Snippets File**

```json
{
  "Activate Agent": {
    "prefix": "agent-activate",
    "body": [
      "I'm pasting an agent definition. Please adopt this role:",
      "",
      "$1",
      "",
      "Now, as this agent, please: $2"
    ]
  }
}
```

---

## Troubleshooting

### "Copilot is not responding"
- Check your GitHub Copilot subscription status
- Ensure you're signed into GitHub in VS Code
- Try reloading the window: `Ctrl+Shift+P` → `Developer: Reload Window`

### "Task not found"
- Ensure `.vscode/tasks.json` exists
- Run `python scripts/setup_vscode_copilot.py` to regenerate

### "Agent context is too long"
- Use a summary section instead of the full agent file
- Focus on the relevant sections (MCP Tools, Workflow)
- Use `#file` reference instead of pasting

### "MCP tools not available"
- MCP tools require external servers; Copilot Chat alone cannot execute them
- Use the integrated terminal to run MCP-dependent operations
- Copilot can help write code that uses MCP tools, but not execute them directly
